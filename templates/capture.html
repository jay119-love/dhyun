<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
<title>Capture</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<style>
:root{ --shutter:56px; --gap-bottom:14px; --gap-top:8px; --line-h:1px }
html,body{margin:0;height:100%;background:#000;color:#fff;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif}
.preview{position:fixed;inset:0;overflow:hidden;background:#000}
#camera{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.controls{position:absolute;left:0;right:0;bottom:0;height:calc(var(--line-h) + var(--gap-top) + var(--shutter) + var(--gap-bottom) + env(safe-area-inset-bottom));display:flex;align-items:flex-end;justify-content:center;padding-bottom:calc(env(safe-area-inset-bottom) + var(--gap-bottom));z-index:2}
.shutter{width:var(--shutter);height:var(--shutter);border-radius:50%;background:rgba(255,255,255,0.08);border:2px solid rgba(255,255,255,0.85);cursor:pointer}
.msg{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.6);padding:12px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.7);display:none;z-index:3;text-align:center;font-size:24px;font-weight:700}
.msg.show{display:block}
</style>
</head>
<body>
<div class="preview">
    <video id="camera" autoplay playsinline muted></video>
    <div id="message" class="msg">카메라 권한을 허용해주세요.</div>
    <div class="controls">
        <button class="shutter" id="shutterBtn" aria-label="촬영"></button>
    </div>
</div>
<canvas id="snapshot" style="display:none"></canvas>
<script>
const video = document.getElementById('camera');
const snapCanvas = document.getElementById('snapshot');
const msg = document.getElementById('message');
const shutterBtn = document.getElementById('shutterBtn');

async function startCamera(){
  try{const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'},audio:false});video.srcObject = stream;msg.classList.remove('show')}catch(e){msg.textContent='카메라 권한을 허용해주세요.';msg.classList.add('show')}
}

function sendToReview(){
  const w = video.videoWidth, h = video.videoHeight;
  snapCanvas.width = w; snapCanvas.height = h;
  const ctx = snapCanvas.getContext('2d');
  ctx.save(); ctx.translate(w,0); ctx.scale(-1,1); ctx.drawImage(video,0,0,w,h); ctx.restore();
  const imgData = snapCanvas.toDataURL('image/jpeg',0.92);
  localStorage.setItem('capturedImage', imgData);
  window.location.href = '/review';
}

shutterBtn.onclick = () => sendToReview();
window.addEventListener('load', startCamera);
</script>
</body>
</html>
